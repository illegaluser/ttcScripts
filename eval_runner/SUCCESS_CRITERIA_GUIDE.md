# `success_criteria` 문법 상세 가이드

**문서 목적**: `golden.csv` 파일의 `success_criteria` 컬럼에 사용되는 규칙의 상세 문법과 사용법을 설명합니다.

---

## 1. 개요

`success_criteria`는 `target_type`이 `agent`인 테스트 케이스의 성공 여부를 **자동으로 판정**하기 위해 사용되는 규칙 문자열입니다.

에이전트는 단순히 정보를 응답하는 것을 넘어, API 호출, 시스템 조작 등 특정 과업(Task)을 수행합니다. 이 필드는 해당 과업이 "성공"했음을 판별할 수 있는 구체적인 신호(signal)를 정의합니다.

만약 이 필드가 비어있을 경우, 평가는 **HTTP 상태 코드가 200인지** 여부만으로 성공을 판정합니다.

## 2. 기본 문법

`success_criteria`는 하나 이상의 조건을 ` AND ` (공백 포함 대문자)로 연결하여 구성됩니다.

```
<조건_1> AND <조건_2> AND ...
```

모든 조건을 만족해야만 해당 테스트 케이스는 `PASS`로 처리됩니다.

## 3. 지원 조건 상세

### 3.1. `status_code=<숫자>`

AI 에이전트를 호출했을 때의 HTTP 응답 상태 코드를 검증합니다.

- **문법**: `status_code=<기대하는 숫자 코드>`
- **예시**: `status_code=200`
- **설명**: API 호출이 성공적으로 처리되었는지(HTTP 200 OK)를 확인하는 가장 기본적인 조건입니다.

### 3.2. `raw~r/<정규식>/`

AI 에이전트의 **전체 원본 응답(raw_response)** 문자열 안에 특정 패턴이 존재하는지를 정규식(Regex)으로 검증합니다.

- **문법**: `raw~r/<검증할 정규식 패턴>/`
- **예시**: `raw~r/Success/`
- **설명**: 응답 본문에 'Success'라는 단어가 포함되어 있는지 확인합니다. 응답이 단순 문자열이거나, 특정 키워드의 존재 여부만으로 성공을 판정할 수 있을 때 유용합니다.

### 3.3. `json.<JSON경로>~r/<정규식>/`

AI 에이전트의 원본 응답을 JSON으로 파싱한 뒤, 특정 경로(JSON Path)에 있는 값의 형식을 정규식으로 검증합니다.

- **문법**: `json.<객체.하위객체.배열[인덱스]>~r/<검증할 정규식 패턴>/`
- **예시**: `json.issue_key~r/^[A-Z]+-\d+$/`
- **설명**:
  - `golden.csv`의 예시 `TC-AGT-002` 케이스에서 사용된 규칙입니다.
  - 응답 JSON에 `issue_key`라는 필드가 존재하고, 그 값이 "프로젝트명-숫자" 형식(예: `DS-123`)의 정규식과 일치하는지 검증합니다.
  - 이를 통해 단순히 "이슈가 생성되었다"는 텍스트 응답뿐만 아니라, 실제 시스템에서 발급된 이슈 키의 형식까지 검증하여 더 높은 신뢰도를 확보할 수 있습니다.

#### JSON 경로 상세

- **객체 접근**: `.`을 사용하여 하위 객체에 접근합니다. (예: `json.meta.status`)
- **배열 접근**: `[인덱스]`를 사용하여 배열의 특정 요소에 접근합니다. (예: `json.data[0].id`)

## 4. 전체 예시

`golden.csv`에 포함된 예시를 통해 전체적인 사용법을 이해할 수 있습니다.

1.  **서버 재시작 (`TC-AGT-001`)**
    - **규칙**: `status_code=200 AND raw~r/Success/`
    - **의미**: HTTP 응답이 200이고, 응답 본문에 "Success"라는 단어가 포함되어야 성공으로 간주합니다.

2.  **이슈 생성 (`TC-AGT-002`)**
    - **규칙**: `status_code=200 AND json.issue_key~r/^[A-Z]+-\d+$/`
    - **의미**: HTTP 응답이 200이고, 응답 JSON의 `issue_key` 필드 값이 `ABC-1234`와 같은 형식이어야 성공으로 간주합니다.