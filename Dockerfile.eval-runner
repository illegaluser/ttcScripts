# 폐쇄망 환경을 고려하여 모든 의존성을 포함하는 Fat Image 전략을 사용합니다.
FROM python:3.11-slim-bookworm

# 1. 시스템 패키지 설치 (Promptfoo 구동을 위한 Node.js 포함)
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl build-essential git nodejs npm \
    && rm -rf /var/lib/apt/lists/*

# 2. Python 라이브러리 설치 (버전 고정으로 재현성 확보)
RUN pip install --no-cache-dir \
    deepeval==1.3.5 \
    pytest==8.0.0 \
    pytest-xdist==3.5.0 \
    pandas==2.2.0 \
    requests==2.31.0 \
    jsonschema==4.21.1 \
    langfuse==2.15.0

# 3. Promptfoo 설치 (정적 보안 분석 도구)
RUN npm install -g promptfoo@0.50.0

# 4. 환경 설정
ENV PYTHONPATH=/app
WORKDIR /app
CMD ["tail", "-f", "/dev/null"]